(window.webpackJsonp=window.webpackJsonp||[]).push([[273],{685:function(t,e,v){"use strict";v.r(e);var _=v(42),a=Object(_.a)({},(function(){var t=this,e=t.$createElement,v=t._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h1",{attrs:{id:"开篇"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#开篇"}},[t._v("#")]),t._v(" 开篇")]),t._v(" "),v("blockquote",[v("p",[t._v("本文主旨是详细说明事务带来的四个数据库问题.")])]),t._v(" "),v("h1",{attrs:{id:"数据丢失"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#数据丢失"}},[t._v("#")]),t._v(" 数据丢失")]),t._v(" "),v("blockquote",[v("p",[t._v("待补充")])]),t._v(" "),v("h1",{attrs:{id:"脏读"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#脏读"}},[t._v("#")]),t._v(" 脏读")]),t._v(" "),v("h2",{attrs:{id:"一句话"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#一句话"}},[t._v("#")]),t._v(" 一句话")]),t._v(" "),v("blockquote",[v("p",[t._v(":能读到未提交事务的数据变化")])]),t._v(" "),v("blockquote",[v("p",[t._v("解决方案:")]),t._v(" "),v("blockquote",[v("ol",[v("li",[t._v("设置"),v("code",[t._v("read committed")]),t._v("以上的事务隔离级别")])])])]),t._v(" "),v("h1",{attrs:{id:"不可重复读"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#不可重复读"}},[t._v("#")]),t._v(" 不可重复读")]),t._v(" "),v("h2",{attrs:{id:"一句话-2"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#一句话-2"}},[t._v("#")]),t._v(" 一句话")]),t._v(" "),v("blockquote",[v("p",[t._v("多次读取数据一直在变化")])]),t._v(" "),v("blockquote",[v("p",[t._v("解决方案:")]),t._v(" "),v("blockquote",[v("ol",[v("li",[t._v("设置"),v("code",[t._v("repeatable read")]),t._v("以上的事务隔离级别")]),t._v(" "),v("li",[t._v("由要进行修改操作的事务显示使用排他锁")]),t._v(" "),v("li",[t._v("或者由重复读的事务显示使用共享锁")])])])]),t._v(" "),v("h1",{attrs:{id:"幻读"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#幻读"}},[t._v("#")]),t._v(" 幻读")]),t._v(" "),v("h2",{attrs:{id:"一句话-3"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#一句话-3"}},[t._v("#")]),t._v(" 一句话")]),t._v(" "),v("blockquote",[v("p",[t._v("多次读取数据, 数据的"),v("code",[t._v("数量")]),t._v("一直在变化")])]),t._v(" "),v("h2",{attrs:{id:"被指幻读的两个必要条件"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#被指幻读的两个必要条件"}},[t._v("#")]),t._v(" 被指"),v("code",[t._v("幻读")]),t._v("的两个必要条件")]),t._v(" "),v("blockquote",[v("ol",[v("li",[t._v("只有"),v("code",[t._v("当前读")]),t._v("才会出现幻读的情况, 普通查询均为"),v("code",[t._v("快照读")]),t._v(".")]),t._v(" "),v("li",[t._v("只有在"),v("code",[t._v("新增")]),t._v("时出现.")])])]),t._v(" "),v("h2",{attrs:{id:"幻读出现的场景"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#幻读出现的场景"}},[t._v("#")]),t._v(" 幻读出现的场景")]),t._v(" "),v("h3",{attrs:{id:"for-update多次当前读导致幻读-read-committed及以下会出现"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#for-update多次当前读导致幻读-read-committed及以下会出现"}},[t._v("#")]),t._v(" for update多次当前读导致幻读(read committed及以下会出现)")]),t._v(" "),v("table",[v("thead",[v("tr",[v("th",{staticStyle:{"text-align":"left"}}),t._v(" "),v("th",[t._v("sessionA")]),t._v(" "),v("th",[t._v("sessionB")]),t._v(" "),v("th",[t._v("sessionC")])])]),t._v(" "),v("tbody",[v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("T1")]),t._v(" "),v("td",[t._v("begin;"),v("br"),t._v("select * from t where d=5 for update"),v("br"),t._v("result:(5,5,5)")]),t._v(" "),v("td"),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("T2")]),t._v(" "),v("td"),t._v(" "),v("td",[t._v("update t set d=5 where id=0")]),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("T3")]),t._v(" "),v("td",[t._v("select * from t where d=5 for update"),v("br"),t._v("result:(0,0,5),(5,5,5)")]),t._v(" "),v("td"),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("T4")]),t._v(" "),v("td"),t._v(" "),v("td"),t._v(" "),v("td",[t._v("insert into t values(1,1,5)")])]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("T5")]),t._v(" "),v("td",[t._v("select * from t where d=5 for update"),v("br"),t._v("result:(0,0,5),(1,1,5),(5,5,5)")]),t._v(" "),v("td"),t._v(" "),v("td")]),t._v(" "),v("tr",[v("td",{staticStyle:{"text-align":"left"}},[t._v("T6")]),t._v(" "),v("td",[t._v("commit;")]),t._v(" "),v("td"),t._v(" "),v("td")])])]),t._v(" "),v("h2",{attrs:{id:"可重复读如何解决幻读"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#可重复读如何解决幻读"}},[t._v("#")]),t._v(" 可重复读如何解决幻读")]),t._v(" "),v("blockquote",[v("p",[t._v("请参考本专题其他文章")])]),t._v(" "),v("blockquote",[v("p",[t._v("解决方案:")]),t._v(" "),v("blockquote",[v("ol",[v("li",[t._v("设置"),v("code",[t._v("serializable")]),t._v("以上的事务隔离级别")]),t._v(" "),v("li",[t._v("可重复读一定程度解决了幻读")])])])])])}),[],!1,null,null,null);e.default=a.exports}}]);