(window.webpackJsonp=window.webpackJsonp||[]).push([[195],{604:function(t,a,s){"use strict";s.r(a);var e=s(42),r=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"happens-before"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#happens-before"}},[t._v("#")]),t._v(" Happens-Before")]),t._v(" "),s("blockquote",[s("p",[t._v("在JMM中，如果"),s("code",[t._v("一个操作执行的结果需要对另一个操作可见")]),t._v("，那么这两个操作之间必须存在happens-before关系。其描述的是可见性问题")]),t._v(" "),s("p",[t._v("操作之间存在Happens-Before关系, 并不意味着按照"),s("code",[t._v("Happens-Before规则")]),t._v("的顺序来执行, 在"),s("code",[t._v("重排序")]),t._v("之后, 执行结果与"),s("code",[t._v("Happens-Before规则")]),t._v("执行结果一致即可.")])]),t._v(" "),s("h1",{attrs:{id:"介绍几种hb规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#介绍几种hb规则"}},[t._v("#")]),t._v(" 介绍几种HB规则")]),t._v(" "),s("blockquote",[s("p",[t._v("这里只列举出与Programmer相关的规则")])]),t._v(" "),s("h3",{attrs:{id:"程序执行的顺序性规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#程序执行的顺序性规则"}},[t._v("#")]),t._v(" 程序执行的顺序性规则")]),t._v(" "),s("blockquote",[s("p",[t._v("在一个线程中, 前面的操作Happens-Before后面的操作")])]),t._v(" "),s("h3",{attrs:{id:"volatile变量规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#volatile变量规则"}},[t._v("#")]),t._v(" volatile变量规则")]),t._v(" "),s("blockquote",[s("p",[t._v("对一个volatile变量的写操作一定Happens-Before其后面对这个变量的读操作")])]),t._v(" "),s("h3",{attrs:{id:"传递性规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#传递性规则"}},[t._v("#")]),t._v(" 传递性规则")]),t._v(" "),s("blockquote",[s("p",[t._v("若A Happens-Before B, 且B Happens-Before C, 则A Happens-Before C.")])]),t._v(" "),s("h3",{attrs:{id:"锁的规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#锁的规则"}},[t._v("#")]),t._v(" 锁的规则")]),t._v(" "),s("blockquote",[s("p",[t._v("对一个锁的解锁操作Happens-Before后面对这个锁的加锁")])]),t._v(" "),s("h3",{attrs:{id:"线程启动规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#线程启动规则"}},[t._v("#")]),t._v(" 线程启动规则")]),t._v(" "),s("blockquote",[s("p",[t._v("主线程在启动子线程前的所有操作Happens-Before于子线程的任意操作")])]),t._v(" "),s("h3",{attrs:{id:"线程中断规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#线程中断规则"}},[t._v("#")]),t._v(" 线程中断规则")]),t._v(" "),s("blockquote",[s("p",[t._v("对线程interrupt()方法的调用Happens-Before于被中断线程的代码检测到中断事件的发生")])]),t._v(" "),s("h3",{attrs:{id:"线程等待规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#线程等待规则"}},[t._v("#")]),t._v(" 线程等待规则")]),t._v(" "),s("blockquote",[s("p",[t._v("它是指主线程 A 等待子线程 B 完成（主线程 A 通过调用子线程 B 的 join() 方法实现），当子线程 B 完成后（主线程 A 中 join() 方法返回），主线程能够看到子线程的操作。当然所谓的“看到”，指的是对共享变量的操作。")])]),t._v(" "),s("h3",{attrs:{id:"对象终结规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#对象终结规则"}},[t._v("#")]),t._v(" 对象终结规则")]),t._v(" "),s("blockquote",[s("p",[t._v("一个对象的初始化完成Happens-Before于他的finalize()方法的开始")])]),t._v(" "),s("h1",{attrs:{id:"场景-案例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#场景-案例"}},[t._v("#")]),t._v(" 场景&案例")]),t._v(" "),s("h3",{attrs:{id:"案例1"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#案例1"}},[t._v("#")]),t._v(" 案例1")]),t._v(" "),s("blockquote",[s("p",[t._v("下面的案例代码reader()方法中, 通过if(v)判断后, 能否读到x=42?")]),t._v(" "),s("p",[t._v("此时应用了Happens-Before规则中的"),s("code",[t._v("程序执行的顺序性规则")]),t._v("、"),s("code",[t._v("volatile变量规则")]),t._v("、"),s("code",[t._v("传递性规则")])]),t._v(" "),s("p",[t._v("说明一下此处传递性规则的体现.\n由于"),s("code",[t._v("x=42")]),t._v("Happens-Before"),s("code",[t._v("v=true")]),t._v(", 且"),s("code",[t._v("v=true")]),t._v("Happens-Before"),s("code",[t._v("读v")]),t._v(", 因此根据传递性规则所述, 则"),s("code",[t._v("x=42")]),t._v("Happens-Before"),s("code",[t._v("读x")]),t._v(".")])]),t._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" TT "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("volatile")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("boolean")]),t._v(" v "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("writer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        x "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        v "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("reader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("v"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("System")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("out"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("println")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);