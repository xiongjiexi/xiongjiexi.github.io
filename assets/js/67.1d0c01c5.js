(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{466:function(a,t,e){"use strict";e.r(t);var s=e(42),r=Object(s.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"openresty"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#openresty"}},[a._v("#")]),a._v(" OpenResty")]),a._v(" "),e("h2",{attrs:{id:"raspberry-pi-安装-openresty"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#raspberry-pi-安装-openresty"}},[a._v("#")]),a._v(" raspberry pi 安装 OpenResty")]),a._v(" "),e("p",[e("a",{attrs:{href:"https://blog.meathill.com/tech/serverside/install-openresty-and-postgresql-on-raspberry-pi-4.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("参考地址"),e("OutboundLink")],1)]),a._v(" "),e("ol",[e("li",[a._v("从官网上下载源码包 "),e("a",{attrs:{href:"http://openresty.org/cn/download.html#%E6%BA%90%E7%A0%81%E5%8F%91%E5%B8%83",target:"_blank",rel:"noopener noreferrer"}},[a._v("下载链接"),e("OutboundLink")],1)]),a._v(" "),e("li",[a._v("安装依赖 "),e("code",[a._v("apt-get install libpcre3-dev libssl-dev perl make build-essential curl")])]),a._v(" "),e("li",[a._v("解压源码包；进入目录执行"),e("code",[a._v("./configure")]),a._v("；然后编译"),e("code",[a._v("make")]),a._v("；执行"),e("code",[a._v("sudo make install")])]),a._v(" "),e("li",[a._v("添加PATH"),e("code",[a._v("export PATH=$PATH:/usr/local/openresty/bin")])]),a._v(" "),e("li",[a._v("可以写hello world了")])]),a._v(" "),e("h2",{attrs:{id:"hello-world"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hello-world"}},[a._v("#")]),a._v(" Hello World")]),a._v(" "),e("ol",[e("li",[a._v("新建一个文件test；再在里面建两个文件夹，分别是"),e("code",[a._v("conf/")]),a._v("和"),e("code",[a._v("logs/")])]),a._v(" "),e("li",[a._v("在conf文件夹下新建"),e("code",[a._v("nginx.conf")]),a._v("，代码如下")])]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("events {\n    worker_connections 1024;\n}\n \nhttp {\n    server {\n        listen 8080;\n        location / {\n            content_by_lua '\n                ngx.say(\"hello, world\")\n            ';\n        }\n    }\n}\n")])])]),e("ol",{attrs:{start:"3"}},[e("li",[a._v("启动服务")])]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("openresty -p `pwd` -c conf/nginx.conf\n")])])]),e("ol",{attrs:{start:"4"}},[e("li",[a._v("验证")])]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("$ curl -i 127.0.0.1:8080\n")])])]),e("h2",{attrs:{id:"小技巧"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#小技巧"}},[a._v("#")]),a._v(" 小技巧")]),a._v(" "),e("h4",{attrs:{id:"重启openresty服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#重启openresty服务"}},[a._v("#")]),a._v(" 重启OpenResty服务")]),a._v(" "),e("div",{staticClass:"language-bash extra-class"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("kill")]),a._v(" -HUP "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" logs/nginx.pid"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("kill")]),a._v(" -1 "),e("span",{pre:!0,attrs:{class:"token variable"}},[e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")]),e("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" logs/nginx.pid"),e("span",{pre:!0,attrs:{class:"token variable"}},[a._v("`")])]),a._v("\n")])])]),e("h4",{attrs:{id:"openresty使用相对路径启动"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#openresty使用相对路径启动"}},[a._v("#")]),a._v(" OpenResty使用相对路径启动")]),a._v(" "),e("p",[a._v("OpenResty 在启动时，会把 OpenResty 启动的命令行参数中的 -p PATH 作为前缀，将相对路径拼接为绝对路径。")]),a._v(" "),e("h4",{attrs:{id:"lua热加载"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#lua热加载"}},[a._v("#")]),a._v(" lua热加载")]),a._v(" "),e("p",[a._v("在nginx.conf 中关闭 lua_code_cache即可；线上要关闭，影响性能。")]),a._v(" "),e("h4",{attrs:{id:"设置lua模块的查找路径"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#设置lua模块的查找路径"}},[a._v("#")]),a._v(" 设置Lua模块的查找路径")]),a._v(" "),e("p",[a._v("可以把 lua_package_path 设置为 $prefix/lua/?.lua;;")]),a._v(" "),e("ul",[e("li",[a._v("$prefix就是启动参数中的 -p PATH；")]),a._v(" "),e("li",[a._v("/lua/?.lua表示 lua 目录下所有以 .lua 作为后缀的文件；")]),a._v(" "),e("li",[a._v("最后的两个分号，则代表内置的代码搜索路径。")])])])}),[],!1,null,null,null);t.default=r.exports}}]);