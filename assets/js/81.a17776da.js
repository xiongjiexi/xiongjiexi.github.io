(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{481:function(e,a,s){"use strict";s.r(a);var t=s(42),r=Object(t.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"kafka"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kafka"}},[e._v("#")]),e._v(" kafka")]),e._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#启动3节点kafka集群"}},[e._v("启动3节点kafka集群")])]),s("li",[s("a",{attrs:{href:"#kafka性能测试"}},[e._v("kafka性能测试")]),s("ul",[s("li",[s("a",{attrs:{href:"#kafka-producer-perf-test-sh脚本参数"}},[e._v("kafka-producer-perf-test.sh脚本参数")])]),s("li",[s("a",{attrs:{href:"#kafka-consumer-perf-test-sh脚本参数"}},[e._v("kafka-consumer-perf-test.sh脚本参数")])])])]),s("li",[s("a",{attrs:{href:"#教程、资料"}},[e._v("教程、资料")])]),s("li",[s("a",{attrs:{href:"#kafkatool"}},[e._v("kafkatool")])])])]),s("p"),e._v(" "),s("h2",{attrs:{id:"启动3节点kafka集群"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动3节点kafka集群"}},[e._v("#")]),e._v(" 启动3节点kafka集群")]),e._v(" "),s("p",[e._v("同一台机器可以copy三份配置文件server.properties，修改其中端口和路径即可。")]),e._v(" "),s("ul",[s("li",[e._v("broker.id 每个kafka唯一")]),e._v(" "),s("li",[e._v("listners=PLAINTEXT://192.168.3.29:9090 表示kakfa监听的地址和端口")]),e._v(" "),s("li",[e._v("log.dirs=/xxx/kafka/logs 同一台机器的每个kafka节点不能相同")]),e._v(" "),s("li",[e._v("zookeeper.connect=192.168.3.29:2181,192.168.3.29:2182,192.168.3.29:2182 zk集群节点")])]),e._v(" "),s("p",[e._v("这样可以在同一台机器启动3个节点的kafka进行测试")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("jesse$ ./kafka-server-start.sh ../config/k1.properties\n\njesse$ ./kafka-server-start.sh ../config/k2.properties\n\njesse$ ./kafka-server-start.sh ../config/k3.properties\n")])])]),s("h2",{attrs:{id:"kafka性能测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kafka性能测试"}},[e._v("#")]),e._v(" kafka性能测试")]),e._v(" "),s("p",[e._v("自带的性能测试工具：kafka-consumer-perf-test.sh、kafka-producer-perf-test.sh")]),e._v(" "),s("p",[e._v("测试producer性能：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("~/kafka/bin$ ./kafka-producer-perf-test.sh --topic topic-t1 --num-records 1000000 --record-size 1000 --throughput 20000 --producer-props bootstrap.servers=192.168.3.29:9090,192.168.3.29:9091,192.168.3.29:9092\n\n99982 records sent, 19992.4 records/sec (19.07 MB/sec), 92.4 ms avg latency, 483.0 ms max latency.\n100071 records sent, 20014.2 records/sec (19.09 MB/sec), 0.7 ms avg latency, 10.0 ms max latency.\n100029 records sent, 20005.8 records/sec (19.08 MB/sec), 0.8 ms avg latency, 11.0 ms max latency.\n100020 records sent, 20000.0 records/sec (19.07 MB/sec), 0.8 ms avg latency, 12.0 ms max latency.\n100040 records sent, 20004.0 records/sec (19.08 MB/sec), 0.8 ms avg latency, 11.0 ms max latency.\n100020 records sent, 20004.0 records/sec (19.08 MB/sec), 0.8 ms avg latency, 11.0 ms max latency.\n100020 records sent, 20000.0 records/sec (19.07 MB/sec), 0.8 ms avg latency, 17.0 ms max latency.\n100032 records sent, 20006.4 records/sec (19.08 MB/sec), 0.8 ms avg latency, 16.0 ms max latency.\n100008 records sent, 19997.6 records/sec (19.07 MB/sec), 0.8 ms avg latency, 10.0 ms max latency.\n1000000 records sent, 19992.003199 records/sec (19.07 MB/sec), 9.95 ms avg latency, 483.00 ms max latency, 1 ms 50th, 2 ms 95th, 385 ms 99th, 473 ms 99.9th.\n")])])]),s("p",[e._v("结果：发送100w记录，每秒发送2w，每秒平均向kafka写入19MB数据，平均时延9.95ms，最大时延483ms，50%的消息处理耗时1ms内，95%的2ms内，99%的385ms内。")]),e._v(" "),s("p",[e._v("测试consumer性能：")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("~/kafka/bin$ ./kafka-consumer-perf-test.sh --broker-list 192.168.3.29:9090,192.168.3.29:9091,192.168.3.29:9092 --topic topic-t1 --fetch-size 1000000 --messages 1000000 --threads 1\n\nWARNING: option [threads] and [num-fetch-threads] have been deprecated and will be ignored by the test\nstart.time, end.time, data.consumed.in.MB, MB.sec, data.consumed.in.nMsg, nMsg.sec, rebalance.time.ms, fetch.time.ms, fetch.MB.sec, fetch.nMsg.sec\n\n2021-07-29 01:14:10:209, 2021-07-29 01:14:15:785, 953.6744, 171.0320, 1000007, 179341.2841, 370, 5206, 183.1875, 192087.3992\n")])])]),s("p",[e._v("结果：5秒左右，消费数据953MB，每秒171MB，总消息数100w，每秒17w，rebalance时间370ms。")]),e._v(" "),s("h3",{attrs:{id:"kafka-producer-perf-test-sh脚本参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kafka-producer-perf-test-sh脚本参数"}},[e._v("#")]),e._v(" kafka-producer-perf-test.sh脚本参数")]),e._v(" "),s("ul",[s("li",[e._v("--topic topic名称")]),e._v(" "),s("li",[e._v("--num-records 总共需要发送的消息数")]),e._v(" "),s("li",[e._v("--record-size 每个记录的字节数")]),e._v(" "),s("li",[e._v("--throughput 每秒钟发送的记录数（限流控制，小于0表示不控制）")]),e._v(" "),s("li",[e._v("--print-metrics 测试完成之后会打印很多指标信息")]),e._v(" "),s("li",[e._v("--producer-props 生产者配置\n"),s("ul",[s("li",[e._v("bootstrap.servers=ip1:port1,ip2:port2,ip3:port3 kafka的服务端ip端口")])])])]),e._v(" "),s("h3",{attrs:{id:"kafka-consumer-perf-test-sh脚本参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kafka-consumer-perf-test-sh脚本参数"}},[e._v("#")]),e._v(" kafka-consumer-perf-test.sh脚本参数")]),e._v(" "),s("ul",[s("li",[e._v("--topic")]),e._v(" "),s("li",[e._v("--fetch-size 每次fetch数据的大小")]),e._v(" "),s("li",[e._v("--messages 总消费的消息数")]),e._v(" "),s("li",[e._v("--threads 线程数")])]),e._v(" "),s("h2",{attrs:{id:"教程、资料"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#教程、资料"}},[e._v("#")]),e._v(" 教程、资料")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://www.yiibai.com/kafka/apache_kafka_introduction.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("易百教程"),s("OutboundLink")],1)]),e._v(" "),s("h2",{attrs:{id:"kafkatool"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#kafkatool"}},[e._v("#")]),e._v(" kafkatool")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://www.kafkatool.com/download.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("下载地址"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("填写zk地址即可连接kafka集群")])])}),[],!1,null,null,null);a.default=r.exports}}]);